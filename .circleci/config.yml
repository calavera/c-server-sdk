# This CircleCI configuration was generated by Releaser for a specific release. It is not to be used
# for regular CI builds. Be aware that rerunning this build may cause it to repeat release actions
# such as publishing to a package manager. However, it will not perform any Git actions other than
# reading the repository.
version: 2.1
orbs:
  win: circleci/windows@1.0.0
workflows:
  version: 2
  test:
    jobs:
      - release-linux
      - release-mac
      - release-windows
jobs:
  release-linux:
    docker:
      - image: ldcircleci/ld-c-sdk-ubuntu
    environment:
      LD_RELEASE_BRANCH: "master"
      LD_RELEASE_CIRCLECI_BRANCH: "release-master"
      LD_RELEASE_DOCS_GITHUB_PAGES: "1"
      LD_RELEASE_DOCS_TITLE: "LaunchDarkly Server-Side SDK for C/C++"
      LD_RELEASE_PROJECT: "c-server-sdk"
      LD_RELEASE_PROJECT_TEMPLATE: ""
      LD_RELEASE_VERSION: "1.2.0"
      LD_LIBRARY_FILE_PREFIX: "linux-gcc-64bit"
      LD_RELEASE_CIRCLECI_TYPE: linux
    steps:
      - checkout
      - run:
          name: "Releaser: prepare"
          command: .ldrelease/circleci/linux/execute.sh prepare
      - run:
          name: "Releaser: build"
          command: .ldrelease/circleci/linux/execute.sh build
      - run:
          name: "Releaser: test"
          command: .ldrelease/circleci/linux/execute.sh test
      - run:
          name: "Releaser: build-docs"
          command: .ldrelease/circleci/linux/execute.sh build-docs
      - run:
          name: "Releaser: publish"
          command: .ldrelease/circleci/linux/execute.sh publish
      - run:
          name: "Releaser: publish-docs"
          command: .ldrelease/circleci/linux/execute.sh publish-docs
      - store_artifacts:
          path: artifacts
  release-mac:
    macos:
      xcode: "9.0"
    environment:
      LD_RELEASE_BRANCH: "master"
      LD_RELEASE_CIRCLECI_BRANCH: "release-master"
      LD_RELEASE_DOCS_GITHUB_PAGES: "1"
      LD_RELEASE_DOCS_TITLE: "LaunchDarkly Server-Side SDK for C/C++"
      LD_RELEASE_PROJECT: "c-server-sdk"
      LD_RELEASE_PROJECT_TEMPLATE: ""
      LD_RELEASE_VERSION: "1.2.0"
      LD_LIBRARY_FILE_PREFIX: "osx-clang-64bit"
      LD_RELEASE_CIRCLECI_TYPE: mac
    steps:
      - checkout
      - run:
          name: "Releaser: prepare"
          command: .ldrelease/circleci/mac/execute.sh prepare
      - run:
          name: "Releaser: build"
          command: .ldrelease/circleci/mac/execute.sh build
      - run:
          name: "Releaser: test"
          command: .ldrelease/circleci/mac/execute.sh test
      - run:
          name: "Releaser: build-docs"
          command: .ldrelease/circleci/mac/execute.sh build-docs
      - run:
          name: "Releaser: publish"
          command: .ldrelease/circleci/mac/execute.sh publish
      - run:
          name: "Releaser: publish-docs"
          command: .ldrelease/circleci/mac/execute.sh publish-docs
      - store_artifacts:
          path: artifacts
  release-windows:
    executor:
      name: win/vs2019
      shell: powershell.exe
    environment:
      LD_RELEASE_BRANCH: "master"
      LD_RELEASE_CIRCLECI_BRANCH: "release-master"
      LD_RELEASE_DOCS_GITHUB_PAGES: "1"
      LD_RELEASE_DOCS_TITLE: "LaunchDarkly Server-Side SDK for C/C++"
      LD_RELEASE_PROJECT: "c-server-sdk"
      LD_RELEASE_PROJECT_TEMPLATE: ""
      LD_RELEASE_VERSION: "1.2.0"
      LD_LIBRARY_FILE_PREFIX: "windows-vs-64bit"
      LD_RELEASE_CIRCLECI_TYPE: windows
    steps:
      - checkout
      - run:
          name: "Releaser: prepare"
          command: .ldrelease/circleci/windows/execute.ps1 -step prepare
      - run:
          name: "Releaser: build"
          command: .ldrelease/circleci/windows/execute.ps1 -step build
      - run:
          name: "Releaser: test"
          command: .ldrelease/circleci/windows/execute.ps1 -step test
      - run:
          name: "Releaser: build-docs"
          command: .ldrelease/circleci/windows/execute.ps1 -step build-docs
      - run:
          name: "Releaser: publish"
          command: .ldrelease/circleci/windows/execute.ps1 -step publish
      - run:
          name: "Releaser: publish-docs"
          command: .ldrelease/circleci/windows/execute.ps1 -step publish-docs
      - store_artifacts:
          path: artifacts
